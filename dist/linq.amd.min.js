define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r extends Error{constructor(t,e){super(`Expected ${t}, got ${e}!`)}}function n(t,...e){if(!t)throw 2===e.length?new r(e[0],e[1]):new Error(e[0])}function o(t){n(y(t),"function",t)}function i(t){n(t instanceof Array,"array",t)}function s(t){n(!_(t),"Sequence is empty!")}function l(t){n(d(t),"iterable",t)}function u(t){n(p(t),"numeric value",t)}function c(t,e,r=1/0){u(t),n(t>=e&&t<=r,`Number must be between ${e} and ${r}!`)}function a(t,e){var r;n(m(r=t),"collection",r),n(p(e),"number",e),n(e>=0&&e<t.count(),"Index is out of bounds")}function f(t,e){return t===e}function h(t,e){return t<e?-1:e<t?1:0}function y(t){return"function"==typeof t}function p(t){return!isNaN(parseFloat(t))}function _(t){return t[Symbol.iterator]().next().done}function d(t){return Symbol.iterator in Object(t)}function m(t){return t instanceof E}function b(t){return t instanceof function*(){}.constructor}e.defaultComparator=h;const g=[Object,Number,Boolean,String,Symbol];function w(t){return/native code/.test(Object(t).toString())||!!~g.indexOf(t)}function x(t,e,r,n){o(r),o(n),s(t);let i=e;for(let e of t)i=r(i,e);return n(i)}function O(t=Object){if(t&&w(t)&&"function"==typeof t){let e=t();return e instanceof Object||t===Date?null:e}return t}function k(t){return o(t),t.length}function v(t,e=h){if(y(t))return new Function("comparator","keySelectorFn","a","b","return comparator(keySelectorFn(a), keySelectorFn(b))").bind(null,e,t);if("string"==typeof t)return t.startsWith("[")||t.startsWith(".")||(t=`.${t}`),new Function("comparator","a","b",`return comparator(a${t}, b${t})`).bind(null,e);throw new r("string or function",t)}class E{constructor(t){this.__iterable=null,n(d(t)||b(t),"iterable or generator",t),this.__iterable=t}[Symbol.iterator](){const t=this.__iterable;return b(t)?t():function*(){yield*t}()}__resultOrDefault(t,e=(t=>!0),r=Object){let n;var i;!w(i=e)&&y(i)&&1==k(i)?n=e:(n=(t=>!0),r=e),o(n);const s=O(r);if(_(this))return s;let l=t.call(this,n);return l||s}elementAt(t){return a(this,t),this.skip(t).take(1).toArray()[0]}take(t=0){if(u(t),t<=0)return E.empty;const e=this;return new E(function*(){let r=0;for(let n of e)if(yield n,++r===t)break})}skip(t=0){return u(t),t<=0?this:this.skipWhile((e,r)=>r<t)}takeWhile(t=((t,e)=>!0)){o(t);const e=this;return new E(function*(){let r=0;for(let n of e){if(!t(n,r++))break;yield n}})}takeUntil(t=((t,e)=>!1)){return this.takeWhile((e,r)=>!t(e,r))}skipWhile(t=((t,e)=>!0)){o(t);const e=this;return new E(function*(){let r=0,n=!1;for(let o of e)!n&&t(o,r++)||(n=!0,yield o)})}skipUntil(t=((t,e)=>!1)){return this.skipWhile((e,r)=>!t(e,r))}first(t=(t=>!0)){return o(t),s(this),this.skipWhile(e=>!t(e)).take(1).toArray()[0]}firstOrDefault(t=(t=>!0),e=Object){return this.__resultOrDefault(this.first,t,e)}last(t=(t=>!0)){return o(t),s(this),this.reverse().first(t)}lastOrDefault(t=(t=>!0),e=Object){return this.__resultOrDefault(this.last,t,e)}single(t=(t=>!0)){o(t),s(this);let e;for(let r of this){if(t(r)){e=r;break}0}if(this.first(r=>t(r)&&!f(r,e)))throw new Error("Sequence contains more than one element");return e}singleOrDefault(t=(t=>!0),e=Object){return this.__resultOrDefault(this.single,t,e)}defaultIfEmpty(t){return _(this)?new E([O(t)]):this}concat(t){l(t);const e=this;return new E(function*(){yield*e,yield*t})}union(t,e=f){return l(t),this.concat(t).distinct(e)}join(t,e,r,n,i=f){l(t),o(e),o(r),o(n),o(i);const s=this;return new E(function*(){for(let o of s){const s=e(o);for(let e of t){const t=r(e);i(s,t)&&(yield n(o,e))}}})}except(t){l(t),m(t)||(t=new E(t));const e=this;return new E(function*(){for(let r of e)t.contains(r)||(yield r)})}zip(t,e){l(t),o(e);const r=this;return new E(function*(){const n=t[Symbol.iterator]();for(let t of r){const r=n.next();if(r.done)break;yield e(t,r.value)}})}intersect(t,e=f){l(t),o(e);const r=this;return new E(function*(){const n=E.from(t);for(let t of r)n.any(r=>e(t,r))&&(yield t)})}sequenceEqual(t,e=f){if(!d(t))return!1;const r=this.toArray();if(t=E.from(t).toArray(),r.length!==t.length)return!1;for(let n=0;n<r.length;n++){if(!e(r[n],t[n]))return!1}return!0}static __getEqualKey(t,e,r){for(let n of t.keys())if(r(n,e))return n;return e}groupBy(t,...e){const r=this;function i(e){let n=2===k(e);const o=r.first();try{const r=t(o);n=n&&e(r,r)&&!e(r,{})}catch(t){n=!1}return n}function s(t){return c(t,t=>t,void 0,f)}function l(t,e){let r,n;return i(e)?(r=e,n=(t=>t)):(r=f,n=e),u(t,n,r)}function u(t,e,r){let n,o,s;return i(r)?n=r:s=r,2===k(e)?s=e:o=e,n||(n=f),o||(o=(t=>t)),c(t,o,s,n)}function c(t,e,i,s){o(t),o(e),n(void 0===i||y(i),"resultSelector must be undefined or function!"),o(s);let l,u=new Map;for(let n of r){const r=E.__getEqualKey(u,t(n),s),o=e(n);u.has(r)?u.get(r).push(o):u.set(r,[o])}return l=i?E.from(u).select(t=>i(...t)):u}let a;switch(e.length){case 0:a=s;break;case 1:a=l;break;case 2:a=u;break;case 3:a=c;break;default:throw new Error("GroupBy parameter count can not be greater than 4!")}return a(t,...e)}groupJoin(t,e,r,n,i=f){l(t),o(e),o(r),o(n);let s=new Map;const u=this;for(let n of u){const o=e(n);s.set(n,new E(function*(){for(let e of t)i(o,r(e))&&(yield e)}))}return new E(function*(){for(let[t,e]of s)yield n(t,e.toArray())})}add(t){this.insert(t,this.count())}insert(t,e){n(e>=0&&e<=this.count(),"Index is out of bounds!");const r=this.toArray();this.__iterable=function*(){yield*r.slice(0,e),yield t,yield*r.slice(e,r.length)}}remove(t){let e=this.toArray();const r=function(t,e){i(t);let r,n,o=[];for(;(n=t.shift())&&!(r=f(n,e));)o.push(n);return t.unshift(...o),r}(e,t);return!!r&&(this.__iterable=function*(){yield*e},!0)}min(t=(t=>t)){return o(t),s(this),Math.min.apply(null,this.select(t).toArray())}max(t=(t=>t)){return o(t),s(this),Math.max.apply(null,this.select(t).toArray())}sum(t=(t=>t)){return s(this),this.select(t).aggregate(0,(t,e)=>t+e)}average(t=(t=>t)){return s(this),this.sum(t)/this.count()}order(t=h){return this.orderBy(t=>t,t)}orderDescending(t=h){return this.orderByDescending(t=>t,t)}orderBy(t,e=h){return o(e),new j(this,v(t,e))}orderByDescending(t,e=h){return new j(this,v(t,(t,r)=>e(r,t)))}shuffle(){return this.orderBy(()=>Math.floor(3*Math.random())-1)}indexOf(t,e=f){o(e);let r=0;for(let n of this){if(e(n,t))return r;r++}return-1}lastIndexOf(t,e=f){o(e);let r=0,n=-1;for(let o of this)e(o,t)&&(n=r),r++;return n}contains(t,e=f){return!!~this.indexOf(t,e)}where(t=((t,e)=>!0)){o(t);const e=this;return new E(function*(){let r=0;for(let n of e)t(n,r)&&(yield n),r++})}conditionalWhere(t,e){return t?this.where(e):this}count(t=(t=>!0)){let e=0,r=this.where(t),n=r[Symbol.iterator]();for(;!n.next().done;)e++;return e}any(t=null){return!_(this)&&(!t||!this.where(t)[Symbol.iterator]().next().done)}all(t=(t=>!0)){return o(t),!this.any(e=>!t(e))}aggregate(t,e=null,r=null){return!y(t)||e||r?y(t)||!y(e)||r?x(this,t,e,r):x(this,t,e,t=>t):x(this.skip(1),this.first(),t,t=>t)}select(t=(t=>t)){const e=this;let r=0;return new E(function*(){for(let n of e)yield t(n,r),r++})}flatten(){return this.selectMany(t=>t)}selectMany(t,e=((t,e)=>e)){o(t),o(e);const r=this;return new E(function*(){let n=0;for(let o of r){let r=t(o,n),i=r;i=d(r)?r:[r];for(let t of i[Symbol.iterator]())yield e(o,t);n++}})}distinct(t=f){return o(t),function(t,e=f){l(t),o(e);const r=[];return new E(function*(){t:for(let n of t){for(let t of r)if(e(n,t))continue t;r.push(n),yield n}})}(this,t)}toArray(){return[...this]}toDictionary(t,e=null,r=null){if(o(t),!e&&!r)return this.toDictionary(t,t=>t,f);if(!r&&1===k(e))return this.toDictionary(t,e,f);if(!r&&2===k(e))return this.toDictionary(t,t=>t,e);o(r),o(e);let i=[],s=new Map;const l=this.toArray();for(let o of l){let l=t(o),u=e(o);n(null!=l,"Key is not allowed to be null!"),n(!E.from(i).any(t=>r(t,l)),`Key '${l}' is already in use!`),i.push(l),s.set(l,u)}return s}toLookup(t,e=null,r=null){return o(t),e||r?(r||1!==k(e))&&(r||2!==k(e))?(o(r),o(e),this.groupBy(t,e,r)):this.groupBy(t,e):this.groupBy(t)}reverse(){const t=this.toArray();return new E(function*(){for(let e=t.length-1;e>=0;e--)yield t[e]})}forEach(t){o(t);for(let e of this)t(e)}static from(t){return new E(t)}static range(t,e){return c(e,0,1/0),new E(function*(){let r=t;for(;r!=e+t;)yield r++})}static repeat(t,e){return c(e,0,1/0),new E(function*(){for(let r=0;r<e;r++)yield t})}static get empty(){return new E([])}}class A{constructor(t,e){this.__index=t,this.__value=e}static __createHeapElement(t,e){return void 0===e||e instanceof A?e:new A(t,e)}}class S{constructor(t,e=h){i(t),o(e),this.__elements=t,this.__comparator=((t,r)=>{let n=e(t.__value,r.__value);return 0!==n?n:h(t.__index,r.__index)}),this.__createHeap(this.__elements,this.__comparator)}__heapify(t,e,r){let n=2*(r+1),o=n-1,i=r;if(t[i]=A.__createHeapElement(i,t[i]),o<t.length&&(t[o]=A.__createHeapElement(o,t[o]),e(t[o],t[i])<0&&(i=o)),n<t.length&&(t[n]=A.__createHeapElement(n,t[n]),e(t[n],t[i])<0&&(i=n)),i!==r){let n=t[r];t[r]=t[i],t[i]=n,this.__heapify(t,e,i)}}__createHeap(t,e){if(0!==t.length)for(let r=Math.floor(t.length/2);r>=0;r--)this.__heapify(t,e,r)}__hasTopElement(){return this.__elements.length>0}__getTopElement(){if(1===this.__elements.length)return this.__elements.pop().__value;let t=this.__elements[0];return this.__elements[0]=this.__elements.pop(),this.__heapify(this.__elements,this.__comparator,0),t.__value}[Symbol.iterator](){let t=this;return{next:function(){return t.__hasTopElement()?{done:!1,value:t.__getTopElement()}:{done:!0,value:void 0}}}}}e.__MinHeap=S;class j extends E{constructor(t,e){o(e),super(t),this.__comparator=e}thenBy(t,e=h){const r=this.__comparator,n=v(t,e),o=(t,e)=>{const o=r(t,e);return 0!==o?o:n(t,e)};return new j(this.__iterable,o)}thenByDescending(t,e=h){return this.thenBy(t,(t,r)=>e(r,t))}[Symbol.iterator](){let t=this,e=super[Symbol.iterator].bind(this);return function*(){yield*new S([...{[Symbol.iterator]:e}],t.__comparator)}()}}function D(t,r=[]){r.push("constructor");let n=e.Collection.from(r),o=[];for(let r of Object.getOwnPropertyNames(Object.getPrototypeOf(e.Collection.empty)))if(!r.startsWith("_")&&!n.contains(r)&&y(e.Collection.empty[r])){if(r in t)throw new Error(`The method "${r}" already exists on the "${t.constructor&&t.constructor.name}" prototype. `+"Use the exclude parameter to patch without this method.");o.push(r)}for(let r of o)t[r]=function(...t){let n=e.Collection.from(this);return n[r].call(n,...t)}}e.Collection=E,e.default=e.Collection,e.extendIterablePrototype=D,e.extendNativeTypes=function(){D(Array.prototype,["concat","forEach","indexOf","join","lastIndexOf","reverse"]);const t=Array.prototype.join;Array.prototype.join=function(...r){if(4==r.length||5==r.length){let t=e.Collection.from(this);return t.join.call(t,...r)}return t.call(this,...r)};const r=Array.prototype.indexOf;Array.prototype.indexOf=function(...t){if(2==t.length&&y(t[1])){let r=e.Collection.from(this);return r.indexOf.call(r,...t)}return r.call(this,...t)};const n=Array.prototype.lastIndexOf;Array.prototype.lastIndexOf=function(...t){if(2==t.length&&y(t[1])){let r=e.Collection.from(this);return r.lastIndexOf.call(r,...t)}return n.call(this,...t)},D(Map.prototype,["add","forEach"]),D(Set.prototype,["add","forEach"])}});