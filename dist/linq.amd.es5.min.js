define(["require","exports"],function(t,e){"use strict";function n(t,...e){if(!t){if(1===e.length)throw new Error(e[0]);if(2===e.length)throw new k(e[0],e[1])}}function r(t){n(h(t),"function",t)}function i(t){n(function(t){return t instanceof Array}(t),"array",t)}function o(t){n(!y(t),"Sequence is empty!")}function u(t){n(d(t),"iterable",t)}function s(t){n(_(t),"numeric value",t)}function l(t,e,r=1/0){s(t),n(t>=e&&t<=r,`Number must be between ${e} and ${r}!`)}function c(t,e){!function(t){n(p(t),"collection",t)}(t),n(_(e),"number",e),n(e>=0&&e<t.Count(),"Index is out of bounds")}function a(t,e){return g(t)===g(e)}function f(t,e){return t<e?-1:e<t?1:0}function h(t){return"function"==typeof t}function _(t){return!isNaN(parseFloat(t))}function y(t){return t[Symbol.iterator]().next().done}function d(t){return Symbol.iterator in Object(t)}function p(t){return t instanceof E}function m(t){return t instanceof function*(){}.constructor}function b(t){return/native code/.test(Object(t).toString())||!!~A.indexOf(t)}function g(t){return JSON.stringify(t)}function w(t,e,n,i){r(n),r(i),o(t);let u=e;for(let e of t)u=n(u,e);return i(u)}function S(t=Object){if(t&&b(t)&&"function"==typeof t){let e=t();return e instanceof Object||t===Date?null:e}return t}function O(t){return r(t),t.length}function T(t,e=f){if(h(t))return new Function("comparator","keySelectorFn","a","b","return comparator(keySelectorFn(a), keySelectorFn(b))").bind(null,e,t);if(function(t){return"string"==typeof t}(t))return t.startsWith("[")||t.startsWith(".")||(t=`.${t}`),new Function("comparator","a","b",`return comparator(a${t}, b${t})`).bind(null,e);throw new k("string or function",t)}Object.defineProperty(e,"__esModule",{value:!0});class k extends Error{constructor(t,e){super(`Expected ${t}, got ${e}!`)}}e.defaultComparator=f;const A=[Object,Number,Boolean,String,Symbol];class E{constructor(t){this.__iterable=null,n(d(t)||m(t),"Parameter must be iterable or generator!"),this.__iterable=t}[Symbol.iterator](){const t=this.__iterable;return m(t)?t():function*(){yield*t}()}__resultOrDefault(t,e=(t=>!0),n=Object){let i;!function(t){return!b(t)&&h(t)&&1==O(t)}(e)?(i=(t=>!0),n=e):i=e,r(i);const o=S(n);if(y(this))return o;let u=t.call(this,i);return u||o}ElementAt(t){return c(this,t),this.Skip(t).Take(1).ToArray()[0]}Take(t=0){if(s(t),t<=0)return E.Empty;const e=this;return new E(function*(){let n=0;for(let r of e)if(yield r,++n===t)break})}Skip(t=0){return s(t),t<=0?this:this.SkipWhile((e,n)=>n<t)}TakeWhile(t=((t,e)=>!0)){r(t);const e=this;return new E(function*(){let n=0;for(let r of e){if(!t(r,n++))break;yield r}})}TakeUntil(t=((t,e)=>!1)){return this.TakeWhile((e,n)=>!t(e,n))}SkipWhile(t=((t,e)=>!0)){r(t);const e=this;return new E(function*(){let n=0,r=!1;for(let i of e)!r&&t(i,n++)||(r=!0,yield i)})}SkipUntil(t=((t,e)=>!1)){return this.SkipWhile((e,n)=>!t(e,n))}First(t=(t=>!0)){return r(t),o(this),this.SkipWhile(e=>!t(e)).Take(1).ToArray()[0]}FirstOrDefault(t=(t=>!0),e=Object){return this.__resultOrDefault(this.First,t,e)}Last(t=(t=>!0)){return r(t),o(this),this.Reverse().First(t)}LastOrDefault(t=(t=>!0),e=Object){return this.__resultOrDefault(this.Last,t,e)}Single(t=(t=>!0)){r(t),o(this);let e;for(let n of this){if(t(n)){e=n;break}0}if(this.First(n=>t(n)&&!a(n,e)))throw new Error("Sequence contains more than one element");return e}SingleOrDefault(t=(t=>!0),e=Object){return this.__resultOrDefault(this.Single,t,e)}DefaultIfEmpty(t){return y(this)?new E([S(t)]):this}Concat(t){u(t);const e=this;return new E(function*(){yield*e,yield*t})}Union(t,e=a){return u(t),this.Concat(t).Distinct(e)}Join(t,e,n,i,o=a){u(t),r(e),r(n),r(i),r(o);const s=this;return new E(function*(){for(let r of s){const u=e(r);for(let e of t){const t=n(e);o(u,t)&&(yield i(r,e))}}})}Except(t){u(t),p(t)||(t=new E(t));const e=this;return new E(function*(){for(let n of e)t.Contains(n)||(yield n)})}Zip(t,e){u(t),r(e);const n=this;return new E(function*(){const r=t[Symbol.iterator]();for(let t of n){const n=r.next();if(n.done)break;yield e(t,n.value)}})}Intersect(t,e=a){u(t),r(e);const n=this;return new E(function*(){const r=E.from(t);for(let t of n)r.Any(n=>e(t,n))&&(yield t)})}SequenceEqual(t,e=a){if(!d(t))return!1;const n=this.ToArray();if(t=E.from(t).ToArray(),n.length!==t.length)return!1;for(let r=0;r<n.length;r++){if(!e(n[r],t[r]))return!1}return!0}static __getEqualKey(t,e,n){for(let r of t.keys())if(n(r,e))return r;return e}GroupBy(t,...e){function i(t){let e=2===O(t);try{e=e&&t(1,1)&&!t(1,2)}catch(t){e=!1}return e}function o(t){return l(t,t=>t,void 0,a)}function u(t,e){let n,r;return i(e)?(n=e,r=(t=>t)):(n=a,r=e),s(t,r,n)}function s(t,e,n){let r,o,u;return i(n)?r=n:u=n,2===O(e)?u=e:o=e,r||(r=a),o||(o=(t=>t)),l(t,o,u,r)}function l(t,e,i,o){r(t),r(e),n(function(t){return void 0===t}(i)||h(i),"resultSelector must be undefined or function!"),r(o);let u,s=new Map;for(let n of c){const r=E.__getEqualKey(s,t(n),o),i=e(n);s.has(r)?s.get(r).push(i):s.set(r,[i])}return u=i?E.from(s).Select(t=>i(...t)):s}const c=this;let f;switch(e.length){case 0:f=o;break;case 1:f=u;break;case 2:f=s;break;case 3:f=l;break;default:throw new Error("GroupBy parameter count can not be greater than 4!")}return f(t,...e)}GroupJoin(t,e,n,i,o=a){u(t),r(e),r(n),r(i);let s=new Map;for(let r of this){const i=e(r);s.set(r,new E(function*(){for(let e of t)o(i,n(e))&&(yield e)}))}return new E(function*(){for(let[t,e]of s)yield i(t,e.ToArray())})}Add(t){this.Insert(t,this.Count())}Insert(t,e){n(e>=0&&e<=this.Count(),"Index is out of bounds!");const r=this.ToArray();this.__iterable=function*(){yield*r.slice(0,e),yield t,yield*r.slice(e,r.length)}}Remove(t){let e=this.ToArray();return!!function(t,e){i(t);let n,r,o=[];for(;(r=t.shift())&&!(n=a(r,e));)o.push(r);return t.unshift(...o),n}(e,t)&&(this.__iterable=function*(){yield*e},!0)}Min(t=(t=>t)){return r(t),o(this),Math.min.apply(null,this.Select(t).ToArray())}Max(t=(t=>t)){return r(t),o(this),Math.max.apply(null,this.Select(t).ToArray())}Sum(t=(t=>t)){return o(this),this.Select(t).Aggregate(0,(t,e)=>t+e)}Average(t=(t=>t)){return o(this),this.Sum(t)/this.Count()}Order(t=f){return this.OrderBy(t=>t,t)}OrderDescending(t=f){return this.OrderByDescending(t=>t,t)}OrderBy(t,e=f){return r(e),new D(this,T(t,e))}OrderByDescending(t,e=f){return new D(this,T(t,(t,n)=>e(n,t)))}Shuffle(){return this.OrderBy(()=>Math.floor(3*Math.random())-1)}IndexOf(t,e=a){r(e);let n=0;for(let r of this){if(e(r,t))return n;n++}return-1}LastIndexOf(t,e=a){r(e);let n=0,i=-1;for(let r of this)e(r,t)&&(i=n),n++;return i}Contains(t,e=a){return!!~this.IndexOf(t,e)}Where(t=((t,e)=>!0)){r(t);const e=this;return new E(function*(){let n=0;for(let r of e)t(r,n)&&(yield r),n++})}ConditionalWhere(t,e){return t?this.Where(e):this}Count(t=(t=>!0)){let e=0,n=this.Where(t)[Symbol.iterator]();for(;!n.next().done;)e++;return e}Any(t=null){return!y(this)&&(!t||!this.Where(t)[Symbol.iterator]().next().done)}All(t=(t=>!0)){return r(t),!this.Any(e=>!t(e))}Aggregate(t,e=null,n=null){return!h(t)||e||n?h(t)||!h(e)||n?w(this,t,e,n):w(this,t,e,t=>t):w(this.Skip(1),this.First(),t,t=>t)}Select(t=(t=>t)){const e=this;let n=0;return new E(function*(){for(let r of e)yield t(r,n),n++})}Flatten(){return this.SelectMany(t=>t)}SelectMany(t,e=((t,e)=>e)){r(t),r(e);const n=this;return new E(function*(){let r=0;for(let i of n){let n=t(i,r),o=n;o=d(n)?n:[n];for(let t of o[Symbol.iterator]())yield e(i,t);r++}})}Distinct(t=a){return r(t),function(t,e=a){u(t),r(e);const n=[];return new E(function*(){t:for(let r of t){for(let t of n)if(e(r,t))continue t;n.push(r),yield r}})}(this,t)}ToArray(){return[...this]}ToDictionary(t,e=null,i=null){if(r(t),!e&&!i)return this.ToDictionary(t,t=>t,a);if(!i&&1===O(e))return this.ToDictionary(t,e,a);if(!i&&2===O(e))return this.ToDictionary(t,t=>t,e);r(i),r(e);let o=[],u=new Map;const s=this.ToArray();for(let r of s){let s=t(r),l=e(r);n(null!=s,"Key is not allowed to be null!"),n(!E.from(o).Any(t=>i(t,s)),`Key '${s}' is already in use!`),o.push(s),u.set(s,l)}return u}ToJSON(){return g(this.ToArray())}Reverse(){const t=this.ToArray();return new E(function*(){for(let e=t.length-1;e>=0;e--)yield t[e]})}ForEach(t){r(t);for(let e of this)t(e)}static from(t){return new E(t)}static Range(t,e){return l(e,0,1/0),new E(function*(){let n=t;for(;n!=e+t;)yield n++})}static Repeat(t,e){return l(e,0,1/0),new E(function*(){for(let n=0;n<e;n++)yield t})}static get Empty(){return new E([])}}E.From=E.from;class x{constructor(t,e){this.__index=t,this.__value=e}static __createHeapElement(t,e){return void 0===e||e instanceof x?e:new x(t,e)}}class v{constructor(t,e=f){i(t),r(e),this.__elements=t,this.__comparator=((t,n)=>{let r=e(t.__value,n.__value);return 0!==r?r:f(t.__index,n.__index)}),this.__createHeap(this.__elements,this.__comparator)}__heapify(t,e,n){let r=2*(n+1),i=r-1,o=n;if(t[o]=x.__createHeapElement(o,t[o]),i<t.length&&(t[i]=x.__createHeapElement(i,t[i]),e(t[i],t[o])<0&&(o=i)),r<t.length&&(t[r]=x.__createHeapElement(r,t[r]),e(t[r],t[o])<0&&(o=r)),o!==n){let r=t[n];t[n]=t[o],t[o]=r,this.__heapify(t,e,o)}}__createHeap(t,e){if(0!==t.length)for(let n=Math.floor(t.length/2);n>=0;n--)this.__heapify(t,e,n)}__hasTopElement(){return this.__elements.length>0}__getTopElement(){if(1===this.__elements.length)return this.__elements.pop().__value;let t=this.__elements[0];return this.__elements[0]=this.__elements.pop(),this.__heapify(this.__elements,this.__comparator,0),t.__value}[Symbol.iterator](){let t=this;return{next:function(){return t.__hasTopElement()?{done:!1,value:t.__getTopElement()}:{done:!0,value:void 0}}}}}e.__MinHeap=v;class D extends E{constructor(t,e){r(e),super(t),this.__comparator=e}ThenBy(t,e=f){const n=this.__comparator,r=T(t,e);return new D(this.__iterable,(t,e)=>{const i=n(t,e);return 0!==i?i:r(t,e)})}ThenByDescending(t,e=f){return this.ThenBy(t,(t,n)=>e(n,t))}[Symbol.iterator](){let t=this,e=super[Symbol.iterator].bind(this);return function*(){yield*new v([...{[Symbol.iterator]:e}],t.__comparator)}()}}e.Collection=E,e.default=e.Collection,e.extendIterablePrototype=function(t){for(let n of Object.getOwnPropertyNames(Object.getPrototypeOf(e.Collection.Empty)))!n.startsWith("_")&&h(e.Collection.Empty[n])&&(t[n]=function(...t){let r=e.Collection.from(this);return r[n].call(r,...t)})}});